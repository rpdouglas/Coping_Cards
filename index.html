<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coping Cards</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div id="appContainer">
    <header>
      <h1>Coping Cards</h1>
      <p class="subtitle">Find strength, focus, and calm — one card at a time.</p>
    </header>

    <!-- DAILY FACT SECTION -->
    <section id="dailyFactSection" class="card">
      <h2>Daily Inspiration</h2>
      <p id="dailyFactText">Loading daily inspiration...</p>
    </section>

    <!-- MAIN NAVIGATION BUTTONS -->
    <section id="homeButtons" class="button-grid">
      <button id="goToCardsBtn" class="primary">🎴 Draw a Coping Card</button>
      <button id="goToJournalBtn" class="secondary">📝 Journal</button>
      <button id="goToTodoBtn" class="secondary">✅ To-Do List</button>
      <button id="goToQuotesBtn" class="secondary">💬 Quotes</button>
      <button id="goToAboutBtn" class="secondary">ℹ️ About</button>
    </section>

    <footer>
      <p>Made with ❤️ for recovery and mindfulness</p>
    </footer>
  </div>

  <!-- ✅ Main Script Logic -->
  <script type="module">
    document.addEventListener("DOMContentLoaded", async () => {
      console.log("🌱 Initializing Coping Cards App...");

      // Try to initialize the main app first
      try {
        const { App } = await import("./global_events.js");
        if (App && typeof App.initializeApp === "function") {
          App.initializeApp();
          console.log("✅ App initialized successfully");
          return;
        } else {
          console.warn("⚠️ App object missing initializeApp(), running fallback...");
        }
      } catch (err) {
        console.error("❌ global_events.js failed to load:", err);
      }

      // --- FALLBACKS (if main import fails) ---

      // 🧠 Load a Daily Fact manually
      try {
        const { AppData } = await import("./data.js");
        const factElem = document.getElementById("dailyFactText");
        const facts = AppData?.dailyFacts || [];
        if (facts.length > 0) {
          const randomFact = facts[Math.floor(Math.random() * facts.length)];
          factElem.textContent = randomFact;
        } else {
          factElem.textContent = "Progress, not perfection — one day at a time.";
        }
        console.log("✅ Daily Fact loaded (fallback).");
      } catch (err) {
        console.error("⚠️ Could not load data.js for Daily Fact:", err);
        document.getElementById("dailyFactText").textContent =
          "Stay strong. You're doing better than you think.";
      }

      // 🎴 Enable Card Buttons manually
      try {
        const { CardLogic } = await import("./coping_cards.js");
        if (CardLogic && typeof CardLogic.bindEventListeners === "function") {
          CardLogic.bindEventListeners();
          console.log("✅ CardLogic initialized (fallback).");
        }
      } catch (err) {
        console.error("⚠️ Could not initialize CardLogic fallback:", err);
      }

      // 🔘 Minimal fallback navigation (so buttons still do something)
      const goToCardsBtn = document.getElementById("goToCardsBtn");
      if (goToCardsBtn) {
        goToCardsBtn.addEventListener("click", () => {
          alert("Coping Card deck is loading...");
        });
      }
    });
  </script>
</body>
</html>